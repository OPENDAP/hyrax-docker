
# Initial Travic-CI control file. 6.11.15 jhrg
# Added sonar scan 3.12.19 jhrg 

dist: trusty

# Use the docker container-based build systems
sudo: false

language: java


services:
    - docker

branches:
  only:
    - master
    - travisbs

notifications:
  email:
    - ndp@opendap.org
    - jgallagher@opendap.org


env:
  global:
    #
    # AWS_ACCESS_KEY_ID for the user 'travis'
    - secure: "n2ADTa+b1lW6kwryZMjCLQCgaY6IIaqru2FL+AZ4Mi+VMhSQ0Cb5Kv9lIlTszftm4aPOEBiO9bBVZo9jHZIQq/P72hMSmIue4UM1Mh/sJe3cLR39bntz1pb/U+2lTnOEaAC9JBsPuAWt0Vw82RY/IP2xC0dg7e8heHLofMSD22olvUXNpooUXYRTl/8LjJ6HwxeMGBvDgujXJPAqcKibdcyRqEOEsn9mS60zFol0j1luTY6SsIDPzDtlDjwxi5N0dM9QBRMq8pgojtePavyge3z0gD3ECL0+Ugw7yCpl6yB9zkFlmUlcMb3YcJdjieYWHOGxEUXkzDghv/M/PkLDjanTU4rhrvkqqxlhMbj5wzhQAFPkxxfLS4LLc6rrbf977JFGVYRRrK2K+6jfEs7+F2mPabu8a2WP5Hvdf4GYzCknH7sWLvn7Ogf6airK0F+n9mCkgLNIFGn2FDohu95C/sZYSs8v7GZqcE6UVeUb4MYVurZa/BW8X74+ReB5oldfHZtz0FKMuLY4Pitao5Q8I6jUunG1dkgv7RhwXRJ4j8IPQ7e5lefu9EnoaGYrLoZ3Is4DO0siS7NUO8KnxfYLkQrRxnM9QQpaL9UJAMVbPz/rvNi9PKqy9Eh2r8uu0HJ96EipYN+z30xE5sGar6wkT40FJEX8DxryldoqWyi1K5E="
    #
    # AWS_SECRET_ACCESS_KEY
    - secure: "OUSPNtk1APEbbTiAerG7q7zccJbHmQs3wwrhHJER9j843fF3hweVkuhBzS6lIFSUuAFm4pBK8eKGvxtcM1MUHQLrbedK3aJrJfN7TkckymcS+Yo0tP7kV86fyOH3lpn+WHl0Fu0TZSkGWlFR7PVj/VW12T5J9007vuIv78a1rrfOJ3p76VBfsEVkfFP2aiG1/qEBhVoErcl9FtrF6dq0MfPhBoRHP4DnvOs0DvwI8O+KWbPecRRizvfuoEgU7aYNyuaQeVsmT0es+eKbI3drvpFp+bHVRnWuPqvpw8BbAgLyk35F0gdZbsgnyUYV9EyMF1D4Jtqw9XD2+1TWVjH4wv5aS1W5eezUHt8cGQy+xjQ9bMHxL+xVm0rcTppTa/HA6VYwldh6u45809d6JkvaWLIpZOMbaO0DgpCjSVB5suDF9tr661QNGs1nTHSxIx4EJtI9ocywUwb8KmVncAamUURSz78AVQWAtCD7qAJ0/pEQHPzYHdSWRpwqj/gvgg6kU8vFXwtPicOvowL3b9rINuyLrQExn6hORI4vIHqujeKRYahhBoWCrByoTL92+XxLlRGgGhb03j2tC9twfwBRwixDCiOImwZnHomO0aa9KkIJzbVeyPjrhxr573Ts+n7Iw0aG/CbAL8bC02NP84j4j3sJneYLES41rG49rbE1c1c="
    #
    # DOCKER_USERNAME for our DockerHub account
    - secure: "SeClVCFBXKAhynv5wD/6OdqLwtK0d5kc0XawlwinPBT2Hg5Y1ZlQKIAZsOwOqXTUcAQtVjnHYLru09ataLuDRIdtcZeDv7TKkE6ZS9nFb4bMM8j6XwxFo2lM4pICks7tY5clClRTvTzdxbkPbmfxHnInHnZmB8md/gOIi3KJseRVS9aignr+1qxyvuyAPha9Rxeiz+iOo4kWKuK3IGiSKp5qIJczoz631f3lsZQJ14Eyiz8vcCL0mJxQ3RbBfl9pNsYmM9XZSCSp9yRNCCDkLGUZNIRNjamy5UFxkhb2meGWOCTAgD5kvRl5LjIv7i2//r46tBN9OMZ8Agz4FvVM9OzWMGCGoimQ6omTp+/+bn+gBhssVoZi4Z9EgYdl2oWPCk8XihmCpFcY/wWrxuYWjQ9u5eXOEVrLp3qNMhmq1X3Z/RWev40b1hWy5ofqjdKfQHsC6j/HHGzxey+VRR9PZHke9c38uOLqb/4Wkaa5Nm3W4cFaeAzyB26GjTe2FiaKZKmYyHz75G52TEoFAOoe2UShp/JDG/HAefr2XJuA1vxHfn/xURMxvoHJ3XEfOORE1S+mP3iREl3Gl1hlp9Dpa6UTWkO6WWdMkBhhX104zyHtTtJu1EebAgoUzoyTe14gi8OgD6FECGyUK4f4c9PlfKabu0y72Nw29t5ef4OKffc="
    #
    # DOCKER_PASSWORD for our DockerHub account
    - secure: "DvQvxpRtfC/EUZ8LjxjL7XvfRRHmt1eimmSbDCAObedkglvjyI0Cvv0njzHDnPLLLZQ2HgtDAzVwZ4OhcJxw0L2olv8/3n01dTwgisziC/bquQHUJHB735naHJUUHB+Id0+02TB9VSJUSeWmlV6wml1hPgk290sHUNQ3+zLxYz51/F6pw4dC4hNuEji0J8A+wDsx2GUGPZaRqiVqAFjKGcnbRTZF/uZ/NRk5AVsxVW+4CF6Jy/e+9WNkj7XlPtPMSS8HCz+20hbhKRJTqlul2pMQOhqWBClEE39kKEd3Mv5UxeCr6hunAEVyS4ig91XgZykSh4/BZ5Tj9aG7LsA0uE4mAhYmN0NrfG3dtfSFSVPF9LwENk2hrh1HSLjuYF1VZpW+sJqnYZmZ35yBY+WtbUd2IwHZ/eVjKk4JX4O2+W3B62GuldSxwYGpoE0wJjmucGSt2XGo7r1nC1Em1rcA9wbzUPjb4Q6/MVPsrX0o3NKUcCn2FoOCat92Ge7WwnIM7LaHm0/6j2uoXLzPd8VAyxLLq0vhyY/7cxQp+8/+j7fIU4K0yJYNq97OOXlcSdkWhNW3kmnE26mPmWUQht5icz0YFAHielPLn3GarZA2X5bYeZ4ffElaN+QFv/4Jy4qRHS0Caml3el2Xi3jqQcj6DFRVKHNdNyvm0JL7b58xfv0="


stages:
- name: besd
  if:  branch = master
- name: olfs
  if:  branch = master
- name: hyrax
  if:  branch = master OR branch = travisbs
- name: hyrax_ncwms
  if:  branch = master

jobs:
  include:
    - stage: besd
      script: 
        - git status;
        - ls -l
        - cd hyrax-snapshot 
        - docker build --build-arg RELEASE_DATE=`date +%s` -t "opendap/besd:snapshot" besd
        - docker image ls -a
        - echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin 
        - docker push opendap/besd:snapshot

    - stage: olfs
      script: 
        #- git checkout snapshot;
        - ls -l
        - cd hyrax-snapshot 
        - docker build --build-arg RELEASE_DATE=`date +%s` -t "opendap/olfs:snapshot" olfs
        - docker image ls -a
        - echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin 
        - docker push opendap/olfs:snapshot

    - stage: hyrax
      script: 
        #- git checkout snapshot;
        - ls -l
        - cd hyrax-snapshot 
        - docker build --build-arg RELEASE_DATE=`date +%s` -t "opendap/hyrax:snapshot" hyrax
        - docker image ls -a
        - echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin 
        - docker push opendap/hyrax:snapshot


    - stage: hyrax_ncwms
      script:
        #- git checkout snapshot;
        - ls -l
        - cd hyrax-snapshot
        - docker build --build-arg RELEASE_DATE=`date +%s` --build-arg USE_NCWMS=true -t "opendap/hyrax_ncwms:snapshot" hyrax
        - docker image ls -a
        - echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin
        - docker push opendap/hyrax_ncwms:snapshot


